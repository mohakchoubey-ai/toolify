<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Clock | Toolify Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: radial-gradient(circle at top right, #1a1a2e, #16213e);
            --card: rgba(255, 255, 255, 0.05);
            --text: #ffffff;
            --primary: #00d2ff;
            --danger: #ff4b2b;
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0; font-family: 'Inter', sans-serif;
            background: var(--bg); color: var(--text);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; overflow-x: hidden;
        }

        /* Navigation */
        .nav-bar {
            width: 100%; max-width: 500px; padding: 20px;
            display: flex; justify-content: space-between; align-items: center;
            box-sizing: border-box;
        }
        .hub-link {
            text-decoration: none; color: var(--primary); font-weight: 700;
            border: 1px solid var(--primary); padding: 8px 16px; border-radius: 12px;
            font-size: 0.8rem; backdrop-filter: blur(10px); transition: 0.3s;
        }
        .hub-link:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }

        /* Main Clock */
        #clock {
            font-size: 5rem; font-weight: 800; margin: 40px 0;
            background: linear-gradient(to bottom, #fff, var(--primary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -2px; text-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        /* Card Design */
        .card {
            background: var(--card); backdrop-filter: blur(20px);
            padding: 30px; border-radius: 30px; border: 1px solid var(--glass-border);
            width: 90%; max-width: 450px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            margin-bottom: 30px; box-sizing: border-box;
        }

        label { font-size: 0.7rem; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1.5px; }

        input {
            width: 100%; padding: 15px; border-radius: 15px; border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.05); color: white; margin: 10px 0 20px 0;
            font-size: 1rem; outline: none; box-sizing: border-box;
        }
        input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0, 210, 255, 0.2); }

        .day-grid { display: flex; gap: 8px; margin-top: 10px; }
        .day {
            flex: 1; padding: 12px 0; border-radius: 12px; border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.05); color: white; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .day.active { background: var(--primary); color: #000; border-color: var(--primary); }

        .save-btn {
            width: 100%; padding: 18px; border-radius: 18px; border: none;
            background: var(--primary); color: #000; font-weight: 800; font-size: 1rem;
            cursor: pointer; margin-top: 25px; transition: 0.3s;
        }
        .save-btn:hover { transform: scale(1.02); box-shadow: 0 0 20px var(--primary); }

        /* Alarm List */
        .alarm-item {
            background: var(--card); border: 1px solid var(--glass-border);
            padding: 20px; border-radius: 20px; display: flex;
            justify-content: space-between; align-items: center;
            margin-bottom: 15px; width: 90%; max-width: 450px; box-sizing: border-box;
        }
        .alarm-info b { font-size: 1.6rem; display: block; }
        .alarm-info small { color: rgba(255,255,255,0.5); }
        .action-btn { background: rgba(255,255,255,0.1); border: none; padding: 10px; border-radius: 12px; cursor: pointer; color: white; margin-left: 5px; }

        /* Overlay */
        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 1000; display: none; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        .overlay.active { display: flex; }
        .stop-btn {
            background: var(--danger); color: white; padding: 20px 60px;
            border-radius: 50px; border: none; font-size: 1.5rem; font-weight: 800;
            cursor: pointer; box-shadow: 0 0 30px var(--danger);
        }

        footer {
            margin-top: auto; width: 100%; padding: 40px 0;
            text-align: center; font-size: 0.75rem; letter-spacing: 2px;
            color: rgba(255, 255, 255, 0.3); border-top: 1px solid var(--glass-border);
        }
    </style>
</head>
<body>

<div class="nav-bar">
    <a href="index.html" class="hub-link">‚Üê TOOLBOX HUB</a>
    <div id="status" style="font-size: 0.7rem; color: var(--primary);">SYSTEM READY</div>
</div>

<h1 id="clock">00:00:00</h1>

<div class="card">
    <label>Set Time</label>
    <input type="time" id="timeInput">
    
    <label>Alarm Name</label>
    <input id="labelInput" placeholder="Meeting, Wake Up..." maxlength="30">

    <label>Repeat Days</label>
    <div class="day-grid">
        <button class="day" data-d="0">S</button>
        <button class="day" data-d="1">M</button>
        <button class="day" data-d="2">T</button>
        <button class="day" data-d="3">W</button>
        <button class="day" data-d="4">T</button>
        <button class="day" data-d="5">F</button>
        <button class="day" data-d="6">S</button>
    </div>

    <button class="save-btn" id="saveBtn" onclick="saveAlarm()">SET ALARM</button>
</div>

<div id="list" style="width: 100%; display: flex; flex-direction: column; align-items: center;"></div>

<div class="overlay" id="overlay">
    <div style="font-size: 5rem; margin-bottom: 20px;">‚è∞</div>
    <h1 id="ringTime" style="font-size: 4rem; margin: 0;">00:00</h1>
    <p id="ringLabel" style="font-size: 1.5rem; color: var(--primary); margin-bottom: 40px;">Wake Up!</p>
    <button class="stop-btn" onclick="stopAlarm()">STOP ALARM</button>
</div>

<audio id="audio" loop preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
</audio>

<footer>DEVELOPED WITH <span style="color:var(--danger)">‚ô•</span> BY MOHAK</footer>

<script>
    let alarms = JSON.parse(localStorage.getItem("essential_alarms") || "[]");
    let selectedDays = [], editId = null;
    const audio = document.getElementById("audio");

    // Initialize Days
    document.querySelectorAll(".day").forEach(btn => {
        btn.onclick = () => {
            btn.classList.toggle("active");
            let d = parseInt(btn.dataset.d);
            if(selectedDays.includes(d)) selectedDays = selectedDays.filter(x => x !== d);
            else selectedDays.push(d);
        };
    });

    function saveAlarm() {
        const timeVal = document.getElementById("timeInput").value;
        if(!timeVal) return alert("Select a time!");

        const newAlarm = {
            id: editId || Date.now(),
            time: timeVal,
            label: document.getElementById("labelInput").value || "Alarm",
            days: selectedDays.length > 0 ? [...selectedDays] : [0,1,2,3,4,5,6],
            lastTriggered: ""
        };

        if (editId) {
            alarms = alarms.map(a => a.id === editId ? newAlarm : a);
            editId = null;
            document.getElementById("saveBtn").innerText = "SET ALARM";
        } else {
            alarms.push(newAlarm);
        }

        localStorage.setItem("essential_alarms", JSON.stringify(alarms));
        render();
        resetForm();
    }

    function render() {
        const list = document.getElementById("list");
        list.innerHTML = "";
        const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
        
        alarms.sort((a,b) => a.time.localeCompare(b.time)).forEach(a => {
            let activeDaysText = a.days.length === 7 ? "Everyday" : a.days.map(d => dayNames[d]).join(', ');
            let div = document.createElement("div");
            div.className = "alarm-item";
            div.innerHTML = `
                <div class="alarm-info">
                    <b>${a.time}</b>
                    <small>${a.label} ‚Ä¢ ${activeDaysText}</small>
                </div>
                <div>
                    <button class="action-btn" onclick="editAlarm(${a.id})">‚úèÔ∏è</button>
                    <button class="action-btn" onclick="delAlarm(${a.id})" style="color:var(--danger)">üóë</button>
                </div>
            `;
            list.appendChild(div);
        });
    }

    function tick() {
        const now = new Date();
        const h = now.getHours().toString().padStart(2, '0');
        const m = now.getMinutes().toString().padStart(2, '0');
        const s = now.getSeconds().toString().padStart(2, '0');
        const currentTime = `${h}:${m}`;
        const day = now.getDay();

        document.getElementById('clock').innerText = `${h}:${m}:${s}`;
        
        alarms.forEach(a => {
            // Logic: Check if it's the right minute AND the right day AND hasn't already rung this minute
            if (a.time === currentTime && a.days.includes(day) && a.lastTriggered !== currentTime) {
                triggerRing(a);
                a.lastTriggered = currentTime; 
            }
        });
    }

    function triggerRing(a) {
        audio.play().catch(() => {
            // If browser blocks audio, user must click anywhere to "unlock" sound
            document.getElementById("status").innerText = "CLICK PAGE TO ENABLE SOUND";
        });
        document.getElementById("ringTime").textContent = a.time;
        document.getElementById("ringLabel").textContent = a.label;
        document.getElementById("overlay").classList.add("active");
    }

    function stopAlarm() {
        audio.pause();
        audio.currentTime = 0;
        document.getElementById("overlay").classList.remove("active");
    }

    window.delAlarm = (id) => {
        alarms = alarms.filter(a => a.id !== id);
        localStorage.setItem("essential_alarms", JSON.stringify(alarms));
        render();
    };

    window.editAlarm = (id) => {
        const a = alarms.find(x => x.id === id);
        if(!a) return;
        editId = a.id;
        document.getElementById("timeInput").value = a.time;
        document.getElementById("labelInput").value = a.label;
        selectedDays = [...a.days];
        document.querySelectorAll(".day").forEach(btn => {
            btn.classList.toggle("active", selectedDays.includes(parseInt(btn.dataset.d)));
        });
        document.getElementById("saveBtn").innerText = "UPDATE ALARM";
    };

    function resetForm() {
        document.getElementById("timeInput").value = "";
        document.getElementById("labelInput").value = "";
        selectedDays = [];
        document.querySelectorAll(".day").forEach(d => d.classList.remove("active"));
    }

    setInterval(tick, 1000);
    render();
</script>
</body>
</html>
